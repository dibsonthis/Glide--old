std = import["../../../dev_env/imports/std/std.gl"]

to_obj = [data::string] => {

    if [data.length == 0] => {
        ret []
    }

    data = data 
    >> std.split["\n"]
    >> std.pop_f
    >> [x] => { x.front = x.front >> std.split[","] ret x }
    >> [x] => { x.rest = x.rest >> std.filter[[elem] => { elem.length > 0 }] ret x}
    >> [x] => { x.rest = x.rest >> std.map[[elem] => { (elem >> std.split[","]) }] ret x }
    >> [x] => {
        _list = []
        for [x.rest i value] => {
            obj = @{}
            for [value j v] => {
                obj.[x.front.[j]] = v
            }
            _list.[_list.length] = obj
        }
        ret _list
    }

    ret data
}

load = [filepath::string] => {
    ret (read[filepath] >> to_obj)
}

save = [filepath::string data::[any]] => {
    data_str = (-(data.[0]._keys) >> std.join[","]) + "\n"
    for [data index row] => {
        data_str += ((-(row._values) >> std.join[","]) + "\n")
    }
    write[filepath data_str]
}